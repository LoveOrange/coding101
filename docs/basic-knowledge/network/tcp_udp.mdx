---
sidebar_position: 2
draft: true
---

# TCP 与 UDP 传输协议

:::tip 核心要点
TCP 是「**可靠**」的传输协议，而 UDP 是「**不可靠**」的传输协议。

TCP 所有的特性都围绕着如何让 TCP 更加「**可靠**」而展开。

UDP 没有「可靠」的设计，换来的是更快的传输速度与更低的延迟。
:::

## 1. TCP 与 UDP 简述

[网络模型](./network-models.mdx)一章提到过，**传输层**关注的是如何传输应用层的数据。

为了应对不同的传输场景，传输层提供了两种不同的传输协议：

1. **TCP**：Transmission Control Protocol，传输控制协议。
2. **UDP**：User Datagram Protocol，用户数据报协议。

虽然全名很难记，但是大部分时候，我们只需要记住：

> TCP 是**可靠**的传输协议，而 UDP 是**不可靠**的传输协议。

这也是这两个协议最核心的区别。

## 2. TCP

### 2.1. TCP 为什么是可靠的

在谈及让 TCP 更加 「**可靠**」 的设计之前，我们先来了解一下数据传输的过程。

想象一下我们需要从互联网上拉取一个 100MB 的视频，需要面对哪些问题：

**1. 如何在网络中传输较大的数据**

网络总是存在波动的。如果一次性传输一整个文件，可能会导致：一旦传输过程出现异常，就需要重新传输一整个文件。

因此合理的方式是将原始数据分割成更小的数据包，然后分批次传输。

100MB 的视频虽然在 202x 年的当下不算大了，但是对于网络传输来说，1MB 的网页都是很大的数据了，100MB 更是巨大。

**2. 如何在比特流中识别到数据包**

在网络数据的传输中，实际传输的是**比特流**。

那么我们就需要知道，在由 **0** 与 **1** 组成的比特流中，哪一段是数据包的开始，到哪里又是数据包的结束。

我们可以使用特定的头部信息来表示当前使用的是 TCP 协议，称为 **TCP 头部**。

为了识别到数据包的长度，头部信息中还需要保存数据包的 **长度**，这样我们就可以在比特流中，识别到每一个数据包的边界。

**3. 如何将分割后的数据包，重新组合成原始数据**

原始数据分成了更小的数据包后，在我们接受的时候，就需要将这些数据包按照正确的顺序重新组合起来。

因此需要使用额外的数据，来记录数据包的**顺序**，这也会记录在 TCP 的协议头中。

**4. 数据包的内容是否正确**

网络波动也有可能会导致我们传输的数据包是不完整的，比如只传输了一半，但是发送方已经宕机了。

比方说对方发送了“我喜欢干饭”，但是你只看到“我喜欢”，这种错误的数据接受方就需要舍弃掉，否做会影响业务的正常运行。

因此我们需要知道，我们接受的数据包的内容，是我们想要且需要接受的内容。

一个简单的方式，就是计算出数据包的 **校验和**，在接收方重新计算一遍，如果与发送方计算的校验和一致，则认为数据包是完整的。

同样，**校验和** 也会被一股脑的扔到 TCP 的头部中。

**5. 数据包丢失**

网络波动也有可能会导致我们传输的数据包丢失。

如果接收方没有收到某一个数据包，那么 TCP 还需要保证这个数据包会重新传输，直到接收方能够收到。

上面只是列举了一些网络传输中可能会面对的问题，而 TCP 协议正是解决了所有的传输过程中，可能会导致数据丢失、无法正确且完整地传输的问题，才会被称为「**可靠**」的传输协议。



